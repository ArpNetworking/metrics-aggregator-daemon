cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.jdk"
sudo: false
env:
  global:
  - JDKW=https://raw.githubusercontent.com/vjkoskela/jdk-wrapper/master/jdk-wrapper.sh
  - JDKW_VERSION=8u65
  - JDKW_BUILD=b17
  - DOCKER_IMAGE_BASE="arpnetworking/mad"
  - secure: VYjBrRGzDEV1AJ0XOrgRQNcUhIRQslKmOIqLyZ44kywXmZIP5WvrzY5KB/F7GS3tSjw/nFIcfOauKO/oXHVnpA/DB/1whTXwKhkBrH0GRap61E9zP9R9wOK3GyfA7lJaB6VOG3CmtEZMViT12jGXcgfsxoCyRwu/ClmBYOtQy3DKy32yYPI/fsX8s6FhsNPdr3pWpju37Pi++V8AsJBV+sPAcGixtlVbiBc3xixOV4Q45AA8U88dherTFKT3PvFVZYH3YD1Mq2C2tI1bCYDY4gbRZbUbqKNX1bOeFPcaS7Idk539Yzh9KbOZEumbW77jf8DNWickBiA/GjmxnAtEzKrlBSpjjdA/FxhJOCNaD/X0nfeEjNTizB+JTiYDDMfuCf19ekdIW6EhsTbEGay13aSz53F5O60SiVKjV35xoHYVblatCFnT8NvU3r9+H6KTRHH7ge7WKbd7bsLmpr49s9me6QcRNyAvo0mLB2UsOCqXgvG+AwtfPdZUQfm/wPTFJsY13TMXoN4Hs/ivcVyz98dcwROiYLbSCW/qwgv+aRQqw5W2+9UWCj94xCR8K9Nuw5POsQ2mra4mPFOatr5rk7sD0XyhQYvB8Bw5hQwwmLcXNsR3en2kF9OivA7yuxxOXA4AXdgG1+eEZ4SmtBf31a0nMzkztKV8gOigB8Co26c=
  - secure: ogevJljn5n5gDVIUgBpwWBD9gz11XYv0p5DErM4ry3dO0K+P9Z+3heH02Dio12tqCae/c9ZUwAH1ToNTBML+kctkxiEQpXqW4mJLgPJ0Uh9UcWiWR2IN9sQbmX12814EBGV5SQLIHRaAsgZoUETfEmXz7MjA4Ti4V0Q2UkbcEOLglNTVUn9xhh96ohNE9ZMWpX3xNAGKBu2ja/3ZfaM/urNPFMZWHnRjumu2P8J2uuger+mNiaE8o4N0b/iz3J9GbZVc9fzkz2/kHYqr7QhJJ1sMTACFukc/7A9/OrKWV83CTg8ltyYcK7tr4ktWaaW8uWbw40YKx9VRN+ukG/QGKes6hjS7zoMYuJzygiBG9I4CdSIVPu5qNVG7VWAuKmbgshDYmxxqvECO7al7rz531GzcvQjOkt6g3/SPm6OIIKXXWhF8tIMDEnNRMUcjAIrkMDp4qrkHm7B6oDjpWE+Xp+CDLZGhZi7d7G3JPpx83wYEt4+2aRCmXV3raJvqqrjG7sY2wULNMSGiB+u4su11APdQ5WDO+H3XelVhLsbAInMtOaSDmdWtr+mqBxLWirfQQnAoDjdI6DjbFziQ9BfdtnjY2ignlSJTh0UfNUBaSzvkIGitbrCrHu1jVhI4QcME1khidMbmnrJeKNNCRekeiJ6ujnENOTi6jRstazWTp/Q=
  - secure: Iq6tftYJEhrxSRdGfM1qtkmtwutn53wBxldlFmOlXmK+A7YzioNZTFngcT2wueErAglofyEE2LsxgBldS0yBGGJWHVx4CjAdg5fzKOxf3aAMVuMj1SXQHon+1YSsEjoyZ8/RYUTnx4bPvzWNhwenpdq2xk0dm3qHdeTr4oAK2xg3r160n+XvOe8AlaerBD7eb5DuzTVHnv16MIBrxz9m0cXXXBvH1eGskK7RGFYlU6D+9cRvHRaV9Wo4bj+mzToxai2fplRbhVxlAUvfeSlBL5Qds0cI6AfmJI9BFligB4uj113m6Uxyprw9CuFvnbSRiyi3EJAQzEaclDzW0GTKxlQ/QJbq1Av+Y+/EentZOmG8jx+vpLQUVZGZBk61znLgvR8scH7Jrehir+aIjKCTXxbfV88h4H27WitGHEDQLSX4l0oZ8LBJNaaNvhli/zXCI8wziKVHdBgWX0l2CDgD7OxK6LjXWP7UqoMUWrUyIN2mq15xjmlDKgFpA09tQ0yE7k++L98YNJdEcoVoxQJ3q80svmlHUa4G0gNEwqSI8o+JRUafTE8r1dbvcGbWVwZ1RTnWo4OY7L61kkWfB5pk9qW32+HLTq0N6FIG/9ieyesfwJn6sWBiLj6waZhYZ+3w/X4mBEdzLRgoHfB0zV6cpfZ2S9PivJpiH4Ny5GLnehI=
  - secure: O7KZwRH1bowB2tdv6GPzy6Ge/u8xE+mL2wPhkCpcHimXfH21gO0T+sIoM4RiomrD/WNQKKdeZsX43W6ZKwx1Dsb3OoLnsKF8biMiAftiJ+ROryy+/m2yy08RY9wOtBAYrYij3lvWNCbOif0unZ0d82sqhcrs0LN/GGkCv+T65PBKCn65SHIi4EboS9Oce4ZPVq6cyo8wliKLRFrSElgBDoVKyrjSPLu84bP9SjPVO5Ycq9QJ/ts/Ns6H/G+u/k9GmsnBQAQafxjSYNmZduVhToRb7n+BDgJb6B9M+ujXQwZgMjQBSVlRdnHdLEXh6EE2RhC6icizwd4MPA1cZUOSDhOXm0RzvekOiO83E37sn4Yv2tsEIDGHqag8y6QiwjYHlzxP5TQCJauo54iyzN8JEwEAp6tGh8phiKnaMJiMCvmeo2uz/f80k+sUh4urxKTSFIA+fD/9g09SujqqAgxyGQ9Ao6yxxctjqlM9equXu29iWNw/aje8ygCxWyxE/u87SCS8xzeZNKhadYmLduGjDcT2g7k2kcI75aOFJ/bMrIcDm4YKc83JUghRHw+MkR5YdD7zdNvnYG0NIxu1c9Ajv657X25hP8OBt+IcJPVmUgTJRLbGIvcsYqQZY1J7LPM6r6KgXmQ8X2G7CfARix4WVTiUVH+em6ZxviFoy039XQo=
  - secure: SWTJB/ZdAmn9v1oaWHUEVYMZ3ImkFRlqHibnigT6wwxs4np+BvObfBxJ+FOMTFasoSqO/W2OKdrrf5r3cKmmqjPgF/g7x4FqYZ5VJsQIZcZlvTgaHkyZCeBlNpfm/JeWUAeG7QB5tOwKofjo0ws2OYmFCa2cgO0GBRs/ZPH6/z9PaPoLAQ5x+jETDo3bOCdz8iB4BbJajuznbHrloa9RezhwEWDk8eIr7Izl9wXT0VUGDkQIUVkv/uvFHScXtn9RLhqzLWHCiwLWZJf6N1pIwuYhiYpjypXuhqQ8g58b2gLAQbbIUg+0M1PT4rRx6veXPdXYd2ZtA0p/roR+9/HmT/jsf7qwaMCthVUn/CKL6X1sFDSRWPpT590EAPnw/iqOjxiqHFRcsnujjBLHhegFy/+LuqjIKBg7S9ORtCgJifoKDlvGzifcdiXC31aENQOmAbRYav5f4CuCuV2rHiuCmLpIYmPj9FBllSGqE6J2qqTnng+9ZaF3KvCj3XlVKbRqjv/6sgApuBS62z4mljWJAmO6mcJ4QU1LApg7UFXeY7goVwdWAhIGkqjs4LZy6ZkmaOw3q1n50TdFBpDa8IatSocFbT+i7MG/vDBTOHIK26w2mAtFzHALrACgy57nHEhSIejmOlSeJgXwox75PLqP2xGw/lEyeJatD8kkKj+6zMg=
  - secure: jmBwyPpZlIweGsacx4I5npe4SjO+emUkJE9RWuWHmQPT6QlRggMSBFgLIR7CeznLvPkjgVWvVAQV0nsQfS4LIsknIloC4Ew81GNCjll7PR8KHzTFZpvP/ilY+ZXt8NG/jHHJdrMao1aeFHkTEOEhTruccWdDSpa6JHV7emdf3Do6JaKGPxaatik+k5DGfUBdiLhU8t2EW3SK7oEtMo2YZ6FGHa+v7bohPenE1pJdHhGurWcndkLpz+TsOD5++dgrBQS2qaioXt4derFzwmAs7R1tNSsWxU+jvkoyXUZNdsa2K1lrzcOAgIqIpztOr3QtJ4F/RylEOSTYlLQSSHchPYkfRI2CRK7JsZE1KTOoVHta6w6l/MvG4glaRBS61adj/p7R7iurBPjWW1uJOx5ti5tL2y4x9LpIlaE/PprhWtM5f2jXpkitqUX4t1puuedkp9a1tQD7GxSqr1XrBy9qmuUZTS2VsjGVDtVdtjiqziq1/ysLFtV9hp6jKHja1kb5N17f6zucoIHSn4Gp/SlkTSe0/DkJAjp4NVUVB5mm/AyT535cQMdmM8GuN1J66KFMCtMfhnE8BaLmSNwLK99V/57yvWAAERGjeeKOxCh+hfmgF5+9JB0AyiBoUhxmxQw1hRn4fxrVwrRM3jMkiEOUR6By1bECO2xTvZEgPqfrOus=
install: true
before_script:
- gpg --import arpnetworking.key
script:
- curl -s ${JDKW} | bash /dev/stdin ./mvnw clean install --settings settings.xml -P ci -Dgpg.skip=true -U
- if [ \( -n "${TRAVIS_TAG}" \) -a "${TRAVIS_PULL_REQUEST}" = "false" ]; then
-   curl -s ${JDKW} | bash /dev/stdin ./mvnw deploy --settings settings.xml -P ci -DskipAllVerification=true
-   if [ $? -eq 0]; then
-     docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
-     version=$(echo "$TRAVIS_TAG" | grep -Po "\d+\.\d+\.\d+$")
-     docker build -t "$DOCKER_IMAGE_BASE:$version" .
-     docker push "$DOCKER_IMAGE_BASE:$version"
-     version=$(echo "$version" | grep -Po "^\d+\.\d+")
-     docker build -t "$DOCKER_IMAGE_BASE:$version" .
-     docker push "$DOCKER_IMAGE_BASE:$version"
-     version=$(echo "$version" | grep -Po "^\d+")
-     docker build -t "$DOCKER_IMAGE_BASE:$version" .
-     docker push "$DOCKER_IMAGE_BASE:$version"
-   fi
- fi
